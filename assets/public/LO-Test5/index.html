<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <script src="./libs/jschannel.1.0.2.min.js" charset="utf-8"></script>
  <script src="https://d3f2ws3vg5f2o9.cloudfront.net/v1/index.js"></script>
  <script type="text/javascript" charset="utf-8">/*
 * -------------------
 * ADAPTER Module
 * -------------------
 *
 * Name: Generic Adapter Module
 * Description: Communicates with container, loads and interactes with Leonardodls SDK Activity
 *
 *
 * External Dependencies : ->
 * Following are shared/common dependencies (specified in index.html), and assumed to loaded via the platform)
 * 1. JQuery
 * 2. JSChannel
 *
 */
(function () {
	var channel, engine;
	var loWithoutControls = true;

	// variable to hold the Activity Player instance
	var activity = null;

	// var to hold current state
	var activityState = null;

	//var to hold the CheckAnswer button status
	var checkAnswerBtnVisible = false;

	//var to hold the Hint button status
	var hintBtnVisible = false;

	//var to hold the Next / Previous button status
	var nextBtnVisible = false;
	var prevBtnVisible = false;

	// relative path for the item JSON
	/*var jsonPath = "data/data.json";*/

	// var to hold unique ID for this LO
	var activityLaunchId;

	/* Function to create/initialize jsChannel */
	var initChannel = function (callback) {
		channel = Channel.build({
			window: window.parent,
			origin: '*',
			scope: 'cup-generic-default',
			onReady: function () {
				callback(channel);
			}
		});
	};

	/* Function to bind methods with the created jschannel instance.  */
	var bindChannel = function (channel) {
		channel.bind('receiveMessageFromContainer', function (trans, params) {
			if (params.type === 'checkAnswers') {
				activity.checkAnswer(checkAnswerCallback.bind(this));
			} else if (params.type === 'sendScores') {
				activity.submit(submitCallback.bind(this));
			} else if (params.type === 'reviewAnswers') {
				//[Review] - Need clarification and purpose of this event
				//return engine.reviewAnswers(params.type);
			} else if (params.type === 'goNext') {

				/*return engine.goToNextScreen(params.type);*/
				return activity.goToNextItem();

			} else if (params.type === 'goPrev') {

				/*return engine.goToPreviousScreen(params.type);*/
				return activity.goToPreviousItem();

			} else if (params.type === 'close') {

				/*return closeConnections();*/
				return activity.destroy();

			} else if (params.type === 'hint') {

				let remainingHintsCount = activity.getCurrentItem().showHints();

				if (remainingHintsCount == 0) {
					updateHintBtnStatus(true, false);
				}

			} else if (params.type === 'currentScreen') {

				return activity.getItems().indexOf(activity.getCurrentItem());

			} else if (params.type === 'totalScreens') {

				return activity.getItems().length;

			}  else if (params.type === 'tryAgain') {

				activity.getCurrentItem().reset();
				updateCheckAnswerBtnStatus();
				updateHintBtnStatus();

			} else if (params.hasOwnProperty('type')) {
				throw { error: "method_not_found", message: 'method not found' };
			} else {
				throw { error: "invalid_request_structure", message: 'invalid request structure' };
			}
		});
	};

	/**
	 * This is the callback function invoked on activity.checkAnswer()
	 */
	var checkAnswerCallback = function(){
		updateState();
		updateCheckAnswerBtnStatus(true, false);
		updateHintBtnStatus(true, false);
	};

	/**
	 * This is the callback function invoked on activity.submit()
	 *
	 * @param {*} eventArgs
	 */
	var submitCallback = function(eventArgs){
		let payload = {
			min: eventArgs.response.score.min,
			max: eventArgs.response.score.max,
			raw: eventArgs.response.score.raw,
			scaled: eventArgs.response.score.scaled
		}
		updateState();
		generateStatement('scored', payload);
		updateCheckAnswerBtnStatus(true, false);
		updateHintBtnStatus(true, false);
		showResult(payload.raw);
	};

	/**
	 * Function invoked to show the result screen in the container
	 * @param {*} score
	 */
	var showResult = function(score){
		var params = {
			type: 'showResult',
			data: {
				score: score,
				review: true
			}
		};
		channel.call({
			method: 'sendMessageToContainer',
			params: params,
			success: function () { },
			error: function () {
				console.log('showResult method error');
			}
		});
	}

	/* Function called when container calls the close method. This function calls engine closeLO method and notifies the
	   container once LO is properly closed and cleaning operations performed, if any */
	var closeConnections = function () {

		channel.notify({
			method: 'sendMessageToContainer',
			params: {
				type: 'terminated'
			}
		});

		/*var callback = function () {

		}
		return activity.destroy(callback);*/
	};

	/* Function to get initialization paramters from the container */
	var getInitParameters = function (callback) {
		channel.call({
			method: 'sendMessageToContainer',
			params: {
				type: 'init'
			},
			success: function (params) {
				callback(params);
			}
		});
	};

	/* Function to load scripts */
	var getScript = function (src, callback) {
		var s = document.createElement("script");
		s.type = "text/" + (src.type || "javascript");
		s.src = src.src || src;
		s.async = false;
		s.onload = function () {
			var state = s.readyState;
			if (!state || /loaded|complete/.test(state)) {
				callback();
			}
		};
		s.onerror = function () {
			console.log('ERROR');
		};
		(document.body || document.head).appendChild(s);
	};

	/* Function called by the engine to notify container with the ready event when the LO is loaded and ready for interaction */
	var DOMReady = function () {
		channel.notify({
			method: 'sendMessageToContainer',
			params: {
				type: 'ready'
			}
		});
	};

	var firstItemReady = function () {
		channel.notify({
			method: 'sendMessageToContainer',
			params: {
				type: 'firstScreenReady'
			}
		});
	}

	/* Function called by the engine to pass controls change data to the container */
	var changeControlsVisibility = function (control, visible, buttonText) {
		var params = {
			type: 'controlsChange',
			data: {
				control: control,
				meta: {
					buttonText: buttonText,
					type: 'button'
				},
				visible: visible
			}
		};
		channel.call({
			method: 'sendMessageToContainer',
			params: params,
			success: function () { },
			error: function () {
				console.log('controlsChange method error');
			}
		});
	};

	/* Function called by the engine to pass dimensions change data to the container */
	var newDimensions = function (dimensions) {
		channel.call({
			method: 'sendMessageToContainer',
			params: {
				type: 'size',
				data: {
					size: dimensions
				}
			},
			success: function () { },
			error: function () {
				console.log('size method error');
			}
		});
	};

	var updateState = function () {
		activityState = activity.getState();

		channel.call({
			method: 'sendMessageToContainer',
			params: {
				type: 'newState',
				data: activityState
			},
			success: function () { },
			error: function () {
				console.log('newState method error');
			}
		});

	}

	var launchActivity = function () {

		// registering the app with leonardo SDK
		LeonardoApp.register();

		var container = document.getElementById('player-container');

		let options = {
			playerConfig: {

				buttons: {
					visible: !loWithoutControls
				}
			},
			events: {
				launched: function (eventArgs) {
					if (activityState) {
						activity.setState(activityState);
					}
					DOMReady();
					firstItemReady();
					updateCheckAnswerBtnStatus();
					updateHintBtnStatus();
					updateNaviagtionButtons();
				},
				change: function (eventArgs) {
					updateState();
					updateCheckAnswerBtnStatus();
				},
				destroy: function () {
					console.log('destroy event');
					closeConnections();
				},
				reset: function (eventArgs) {
					updateState();
					updateHintBtnStatus();
				},
				itemNavigation: function (eventArgs) {
					updateCheckAnswerBtnStatus();
					updateHintBtnStatus();
					updateNaviagtionButtons();
				},
				error: function (eventArgs) {
					console.log(eventArgs);
				},
				size: function (eventArgs) {
					dims = eventArgs.size;
					if (dims) {
						container.style.height = dims.height + "px";
						delete dims.width;
						/*container.style.width = dims.width + "px";*/
						newDimensions(dims);
					}
				}
			},
			uiStyles: {
				horizontalAlignment: "center"
			}
		}


		//let baseURL = document.baseURI;

		// dataJSON is made available in the window by the index.html
		/* var activityItems = dataJSON.map(item => {
			if (item.type == "url") {
				return baseURL + item[item.type];
			}
			else {
				return item[item.type];
			}
		}); */
		LeonardoApp.Activity.init(activityLaunchId, activityJson, container, options).then((player) => {
			activity = player;
		});

		LeonardoApp.Activity.render(activityLaunchId);

		/*fetch(jsonPath)
			.then(res => res.json())
			.then(function (itemArr) {

		});*/

	}

	/* Function to generate statement - started/launched/scored etc.*/
	var generateStatement = function (verb, payload) {
		var statement = {
			verb: {
				"id": "http://adlnet.gov/expapi/verbs/" + verb,
				"display": {
					"und": verb
				}
			},
			object: {
				"id": activityLaunchId
			}
		};
		if (verb === 'scored') {
			statement.result = {
				score: {
					max: payload.max,
					min: payload.min,
					raw: payload.raw,
					scaled: payload.raw / payload.max
				}
			}
		}
		var statementsArray = [];
		statementsArray.push(statement);
		channel.call({
			method: 'sendMessageToContainer',
			params: {
				type: 'newStatements',
				data: statementsArray
			},
			success: function () { },
			error: function () {
				console.log('newStatements method error');
			}
		});
	};

	var updateCheckAnswerBtnStatus = function (forceUpdate, visible) {
		if (forceUpdate) {
			changeControlsVisibility('checkAnswers', visible, "Check Answer");
			checkAnswerBtnVisible = visible;
		}
		else {
			let currentItemStatus = activityState ? activityState.itemBody.questions[activity.getCurrentItemIndex()].outcome.status : "NotStarted";
			if (currentItemStatus == "InProgress") {
				if (checkAnswerBtnVisible == false) {
					changeControlsVisibility('checkAnswers', true, "Check Answer");
					checkAnswerBtnVisible = true;
				}
			}
			else if (checkAnswerBtnVisible) {
				changeControlsVisibility('checkAnswers', false, "Check Answer");
				checkAnswerBtnVisible = false;
			}
		}
	};

	var updateHintBtnStatus = function (forceUpdate, visible) {
		if (forceUpdate) {
			changeControlsVisibility('hint', visible, "Hints");
			hintBtnVisible = visible;
		}
		else {
			if (activity.getCurrentItem().hasHints() && activity.getCurrentItem().remainingHints() != 0) {
				if (hintBtnVisible == false) {
					changeControlsVisibility('hint', true, "Hints");
					hintBtnVisible = true;
				}
			}
			else if (hintBtnVisible) {
				changeControlsVisibility('hint', false, "Hints");
				hintBtnVisible = false;
			}
		}
	};

	var updateNaviagtionButtons = function () {
		/* To be handled by Experience App Test Player*/
		let itemCount = activity.getItemCount();
		if (itemCount > 1) {
			if (activity.getCurrentItemIndex() == 0) {
				if (nextBtnVisible == false) {
					changeControlsVisibility('goNext', true, "Next");
					nextBtnVisible = true;
				}
				if (prevBtnVisible == true) {
					changeControlsVisibility('goPrev', false, "Previous");
					prevBtnVisible = false;
				}
			}
			else if (activity.getCurrentItemIndex() == itemCount - 1) {
				if (nextBtnVisible == true) {
					changeControlsVisibility('goNext', false, "Next");
					nextBtnVisible = false;
				}
				if (prevBtnVisible == false) {
					changeControlsVisibility('goPrev', true, "Previous");
					prevBtnVisible = true;
				}
			}
			else {
				if (nextBtnVisible == false) {
					changeControlsVisibility('goNext', true, "Next");
					nextBtnVisible = true;
				}
				if (prevBtnVisible == false) {
					changeControlsVisibility('goPrev', true, "Previous");
					prevBtnVisible = true;
				}
			}
		}
	}

	/* DOM Ready event */
	document.addEventListener('DOMContentLoaded', function () {
		initChannel(
			function (channel) {
				bindChannel(channel);


				/* Get initiliazation paramters - contentPath and state, if any. */
				getInitParameters(function (initParams) {

					activityLaunchId = initParams.id || "launchId1";

					loWithoutControls = initParams.hasOwnProperty('loWithoutControls') ? initParams.loWithoutControls : true;
					if (initParams.hasOwnProperty('state') && initParams.state) {
						activityState = initParams.state;
					}

					// setting conumer config based on init params and default consumer key present in the index.html of this LO
					if (initParams && initParams.consumerConfig) {
						consumerConfig = initParams.consumerConfig;
					}

					if (consumerConfig) {
						LeonardoApp.setConfigV2(consumerConfig);
					}

					generateStatement('started');

					launchActivity();

				});
			});
	});

})();
</script>

  <style>
    html {
      height: 100%;
      width: 100%;
    }

    body {
      height: 100%;
      width: 100%;
      margin: 0px;
    }

    #player-container {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="player-container"></div>

  <script>
    // global variable being used inside lo-adapter
    // var stores the collection of items to be loaded in activity
    var activityJson = {"_id":"5e047fca6a280900045abcf5","displayType":"master","status":"in-process","systemMeta":{"schemaVersion":"2.0","revision":1,"state":"draft","orgId":"leonardo-dev","assetsBasePath":null,"created":{"userId":"be6d5f4a-46f9-11e8-83c3-0acad1ee5072","timestamp":"2019-12-26T09:39:22.333Z"},"lastModified":{"userId":"be6d5f4a-46f9-11e8-83c3-0acad1ee5072","timestamp":"2019-12-30T12:00:57.128Z"},"itemIndex":5},"type":"collection","subType":"test","toolName":"paint","toolVersion":"1.0","itemMeta":{"title":"Question Bank","description":"This Question Bank is a collection of a variety of questions","tags":{}},"itemBody":{"questions":[{"placement":"external-meta","id":"ITEM01","meta":{"title":"Question #1","stimulus":{"content":{"type":"item-xhtml","data":"<p>Type Question Text Here</p>"}},"type":"multiple-choice","status":"in-process","score":2}},{"placement":"external-meta","id":"ITEM02","meta":{"title":"Question #2","stimulus":{"content":{"type":"item-xhtml","data":"<p>Type Question Text Here</p>"}},"type":"multiple-choice","status":"in-process","score":2}},{"placement":"external-meta","id":"ITEM03","meta":{"title":"Question #31","stimulus":{"content":{"type":"item-xhtml","data":"<p>Type Question Text Here</p>"}},"type":"multiple-choice","status":"in-process","score":2}}]},"itemResources":null,"itemId":"leonardo-dev-5","__v":0,"itemFragments":{"ITEM01":{"itemId":{"itemId":"leonardo-dev-1553","type":"question","subType":"mcsr-radio","status":"complete","displayType":"embedded","toolName":"paint","toolVersion":1,"systemMeta":{"orgId":"leonardo-dev","state":"draft","revision":1,"created":{"timestamp":"2019-09-03T05:38:18.168Z","userId":"be6d5f4a-46f9-11e8-83c3-0acad1ee5072"},"lastModified":{"timestamp":"2019-09-04T12:57:42.535Z","userId":"be6d5f4a-46f9-11e8-83c3-0acad1ee5072"},"schemaVersion":2,"assetsBasePath":"https://s3.amazonaws.com/paint.leonardodls.com/organization_bucket/"},"itemMeta":{"title":"Title","description":"Description","tags":{"domain":"Engineering","difficulty":"Beginner","custom":[""]},"skill":"","learningObjective":""},"itemBody":{"instruction":{"content":{"type":"item-text","data":"Read the passage and answer the question given below:"}},"content":{"type":"item-xhtml","data":"<p style='padding: 0px 15px;'>At sun set Ram and Laxman come in a chariot with Vanar Sena. Ram shoots arrows at the effigies. The effigies catch fire and burn to ashes. Fireworks and crackers explode in the air. People in some areas of Rajasthan go to greet each other. Dussehra is a symbol of victory of good over evil.</p><h3 style='background: white; margin: 0px; padding: 15px;'  >The passage is about -</h3>"},"options":[{"id":"O1","content":{"type":"item-text","data":"Chariot"},"feedback":{"content":{"type":"item-text","data":""}}},{"id":"O2","content":{"type":"item-text","data":"Vanar Sena"},"feedback":{"content":{"type":"item-text","data":"Feedback B"}}},{"id":"O3","content":{"type":"item-text","data":"Dussehra"},"feedback":{"content":{"type":"item-text","data":"Feedback C"}}}],"validation":{"matchingType":"id","score":2,"value":"O3"},"preferences":{"shuffle":true,"layout":{"orientation":"vertical/horizontal"}},"feedback":{"general":{"content":{"type":"item-text","data":""}},"correct":{"content":{"type":"item-text","data":""}},"incorrect":{"content":{"type":"item-text","data":"The passage is about Dussehra."}}},"hints":[{"id":"H1","content":{"type":"item-text","data":"It is a popular Hindu festival."}},{"id":"H2","content":{"type":"item-text","data":"It symbolises victory of good over evil."}}]},"itemResources":{"RE1":{"type":"image","systemAttribs":{"fileName":"initial.png","fileSize":19785,"uploadedOn":"2019-02-14T11:20:51.099Z"},"resourceInfo":{}}},"itemResponse":{"userResponse":{"value":""},"outcomes":{"score":0,"status":""},"consumedHints":[]}}},"ITEM02":{"itemId":{"itemId":"leonardo-dev-1553","type":"question","subType":"mcsr-radio","status":"complete","displayType":"embedded","toolName":"paint","toolVersion":1,"systemMeta":{"orgId":"leonardo-dev","state":"draft","revision":1,"created":{"timestamp":"2019-09-03T05:38:18.168Z","userId":"be6d5f4a-46f9-11e8-83c3-0acad1ee5072"},"lastModified":{"timestamp":"2019-09-04T12:57:42.535Z","userId":"be6d5f4a-46f9-11e8-83c3-0acad1ee5072"},"schemaVersion":2,"assetsBasePath":"https://s3.amazonaws.com/paint.leonardodls.com/organization_bucket/"},"itemMeta":{"title":"Title","description":"Description","tags":{"domain":"Engineering","difficulty":"Beginner","custom":[""]},"skill":"","learningObjective":""},"itemBody":{"instruction":{"content":{"type":"item-text","data":"Watch the video given below and answer the question that follows:"}},"content":{"type":"item-xhtml","data":"<style>.video-responsive{overflow:hidden;padding-bottom:56.25%;position:relative;height:0}.video-responsive iframe{left:0;top:0;height:100%;width:100%;position:absolute}</style><div style='padding-left:15px;padding-right:15px;'><div style='max-width: 480px;margin: 0 auto;'><div class='video-responsive'> <iframe width='560' height='315' src='https://www.youtube.com/embed/libKVRa01L8' frameborder='0' allow='accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture' allowfullscreen></iframe></div></div></div><div style='text-align:center;padding-left:15px;padding-right:15px;'><h3 style='font-family: Roboto, sans-serif; margin-left: 24px;'  >Who is known as the \"father of science\" ?</h3></div>"},"options":[{"id":"O1","content":{"type":"item-text","data":"Albert Einstein is known as the father of science."},"feedback":{"content":{"type":"item-text","data":""}}},{"id":"O2","content":{"type":"item-text","data":"Galileo Galilei is known as the father of science."},"feedback":{"content":{"type":"item-text","data":"Feedback B"}}},{"id":"O3","content":{"type":"item-text","data":"Newton is known as the father of science."},"feedback":{"content":{"type":"item-text","data":"Feedback C"}}}],"validation":{"matchingType":"id","score":2,"value":"O1"},"preferences":{"shuffle":true,"layout":{"orientation":"vertical/horizontal"}},"feedback":{"general":{"content":{"type":"item-text","data":""}},"correct":{"content":{"type":"item-text","data":""}},"incorrect":{"content":{"type":"item-text","data":"Albert Einstein is known as the father of science"}}},"hints":[{"content":{"type":"item-text","data":"A German-born theoretical physicist who developed the theory of relativity"}},{"content":{"type":"item-text","data":"Hint 2"}}]},"itemResources":{"RE1":{"type":"image","systemAttribs":{"fileName":"initial.png","fileSize":19785,"uploadedOn":"2019-02-14T11:20:51.099Z"},"resourceInfo":{}}},"itemResponse":{"userResponse":{"value":""},"outcomes":{"score":2,"status":"correct"}}}},"ITEM03":{"itemId":{"itemId":"leonardo-dev-1553","type":"question","subType":"mcsr-radio","status":"complete","displayType":"embedded","toolName":"paint","toolVersion":1,"systemMeta":{"orgId":"leonardo-dev","state":"draft","revision":1,"created":{"timestamp":"2019-09-03T05:38:18.168Z","userId":"be6d5f4a-46f9-11e8-83c3-0acad1ee5072"},"lastModified":{"timestamp":"2019-09-04T12:57:42.535Z","userId":"be6d5f4a-46f9-11e8-83c3-0acad1ee5072"},"schemaVersion":2,"assetsBasePath":"https://s3.amazonaws.com/paint.leonardodls.com/organization_bucket/"},"itemMeta":{"title":"Title","description":"Description","tags":{"domain":"Engineering","difficulty":"Beginner","custom":[""]},"skill":"","learningObjective":""},"itemBody":{"instruction":{"content":{"type":"item-text","data":"Read the passage and answer the question given below:"}},"content":{"type":"item-xhtml","data":"<p style='padding: 0px 15px;'>At sun set Ram and Laxman come in a chariot with Vanar Sena. Ram shoots arrows at the effigies. The effigies catch fire and burn to ashes. Fireworks and crackers explode in the air. People in some areas of Rajasthan go to greet each other. Dussehra is a symbol of victory of good over evil.</p><h3 style='background: white; margin: 0px; padding: 15px;'  >The passage is about -</h3>"},"options":[{"id":"O1","content":{"type":"item-text","data":"Chariot"},"feedback":{"content":{"type":"item-text","data":""}}},{"id":"O2","content":{"type":"item-text","data":"Vanar Sena"},"feedback":{"content":{"type":"item-text","data":"Feedback B"}}},{"id":"O3","content":{"type":"item-text","data":"Dussehra"},"feedback":{"content":{"type":"item-text","data":"Feedback C"}}}],"validation":{"matchingType":"id","score":2,"value":"O3"},"preferences":{"shuffle":true,"layout":{"orientation":"vertical/horizontal"}},"feedback":{"general":{"content":{"type":"item-text","data":""}},"correct":{"content":{"type":"item-text","data":""}},"incorrect":{"content":{"type":"item-text","data":"The passage is about Dussehra."}}},"hints":[{"id":"H1","content":{"type":"item-text","data":"It is a popular Hindu festival."}},{"id":"H2","content":{"type":"item-text","data":"It symbolises victory of good over evil."}}]},"itemResources":{"RE1":{"type":"image","systemAttribs":{"fileName":"initial.png","fileSize":19785,"uploadedOn":"2019-02-14T11:20:51.099Z"},"resourceInfo":{}}},"itemResponse":{"userResponse":{"value":""},"outcomes":{"score":0,"status":""},"consumedHints":[]}}}}};

    // global variable being used inside lo-adapter
    var consumerConfig = {
      "players": {
        "playerMap": {
          "test": "multi-item-activity-player",
          "mcsr-radio": "mcq-radio-player"
        },
        "modules": {
          "multi-item-activity-player": {
            "baseURL": "https://d3f2ws3vg5f2o9.cloudfront.net/modules/multi-item-activity-player/releases/",
            "version": "0.0.11",
            "js": "0.0.11/multiItemActivityPlayer",
            "css": "0.0.11/multiItemActivityPlayer"
          },
          "mcq-radio-player": {
            "baseURL": "https://d3f2ws3vg5f2o9.cloudfront.net/modules/mcq-radio-player/releases/",
            "version": "0.0.7",
            "js": "0.0.7/libs-mcsr-radio-item-player",
            "dependencies": [
              "react",
              "react-dom",
              "libs-player-ui-components"
            ]
          },
          "react": {
            "baseURL": "https://d3f2ws3vg5f2o9.cloudfront.net/modules/react/releases/",
            "version": "16.12.0",
            "js": "16.12.0/react.development"
          },
          "react-dom": {
            "baseURL": "https://d3f2ws3vg5f2o9.cloudfront.net/modules/react-dom/releases/",
            "version": "16.12.0",
            "js": "16.12.0/react-dom.development"
          },
          "libs-player-ui-components": {
            "baseURL": "https://d3f2ws3vg5f2o9.cloudfront.net/modules/libs-player-ui-components/releases/",
            "version": "0.0.1",
            "js": "0.0.1/libs-player-ui-components"
          }
        }
      }
    }
  </script>

</body>

</html>